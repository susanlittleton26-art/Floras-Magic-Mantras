<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Flora‚Äôs Magic Mantras</title>
  <meta name="description" content="Daily motivational quotes for teens ‚Äî positive, bite-sized mantras to power your day." />
  <meta name="theme-color" content="#0b1220" />
  <link rel="manifest" href="manifest.webmanifest" />
  <link rel="apple-touch-icon" href="icons/icon-192.png" />
  <link rel="icon" type="image/png" href="icons/icon-192.png" />
  <style>
    :root {
      --bg: #0b1220;
      --card: #111a2e;
      --fg: #eaf1ff;
      --muted: #a8b3cf;
      --accent: #8bc6ff;
      --pill: #1a2540;
    }
    [data-theme="light"] {
      --bg: #f7f9ff;
      --card: #ffffff;
      --fg: #0f172a;
      --muted: #475569;
      --accent: #2563eb;
      --pill: #eef2ff;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font: 16px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      color: var(--fg);
      background: radial-gradient(1200px 800px at 100% -10%, rgba(139,198,255,.12), transparent 60%),
                  radial-gradient(900px 600px at -10% 110%, rgba(255,138,201,.12), transparent 60%),
                  var(--bg);
      display: grid;
      place-items: center;
      padding: 24px;
    }
    .wrap { width: 100%; max-width: 720px; }
    header {
      display: flex; align-items: center; justify-content: space-between; gap: 12px;
      margin-bottom: 18px;
    }
    .brand { display: flex; align-items: center; gap: 10px; }
    .logo { font-size: 28px; }
    .title { font-weight: 800; letter-spacing: .2px; font-size: 20px; }
    .subtitle { color: var(--muted); font-size: 13px; margin-top: 2px; }

    .card {
      background: linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,0)) , var(--card);
      border: 1px solid rgba(255,255,255,.06);
      border-radius: 24px;
      box-shadow: 0 10px 30px rgba(0,0,0,.25);
      padding: 22px;
    }

    .quote {
      font-size: clamp(20px, 4.2vw, 30px);
      font-weight: 700;
      letter-spacing: .2px;
      margin: 10px 0 14px;
    }
    .author { color: var(--muted); font-size: 14px; }

    .row { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 16px; }

    button, .pill {
      appearance: none; border: 1px solid transparent; background: var(--pill); color: var(--fg);
      padding: 10px 14px; border-radius: 999px; font-weight: 600; cursor: pointer;
      transition: transform .06s ease, background .2s ease, opacity .2s ease;
    }
    button:hover { transform: translateY(-1px); }
    button:active { transform: translateY(0); }

    .primary { background: linear-gradient(135deg, var(--accent), #a78bfa); color: white; }
    .ghost { background: transparent; border-color: rgba(255,255,255,.12); }

    .meta { display: flex; align-items: center; gap: 8px; color: var(--muted); font-size: 13px; }
    .spacer { flex: 1; }

    .list-title { font-size: 14px; color: var(--muted); margin: 18px 2px 8px; }
    .chips { display: flex; flex-wrap: wrap; gap: 8px; }

    .fav { display: grid; grid-template-columns: 1fr auto; gap: 8px; align-items: center; }
    .fav p { margin: 0; font-weight: 600; }

    details { background: rgba(255,255,255,.03); border: 1px dashed rgba(255,255,255,.1); padding: 14px; border-radius: 16px; }
    summary { cursor: pointer; font-weight: 700; }

    .input {
      width: 100%; padding: 10px 12px; border-radius: 12px; border: 1px solid rgba(255,255,255,.12);
      background: transparent; color: var(--fg); outline: none; font-size: 14px;
    }
    .muted { color: var(--muted); font-size: 14px; }
    .footer { text-align: center; color: var(--muted); font-size: 12px; margin-top: 16px; }
    .link { color: var(--accent); text-decoration: none; }
  .fadeable{transition:opacity .35s ease} .is-hidden{opacity:0}
  .breathing-ring {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 240px;
    height: 240px;
    border-radius: 50%;
    border: 2px solid var(--accent);
    opacity: 0.25;
    pointer-events: none;
    z-index: 0;
    animation: breathe 5s ease-in-out infinite;
  }
  @keyframes breathe {
    0% { transform: translate(-50%, -50%) scale(0.9); opacity: 0.2; }
    50% { transform: translate(-50%, -50%) scale(1.15); opacity: 0.4; }
    100% { transform: translate(-50%, -50%) scale(0.9); opacity: 0.2; }
  }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo">üå∏</div>
        <div>
          <div class="title">Flora‚Äôs Magic Mantras</div>
          <div class="subtitle">Daily motivational quotes ‚Äî simple boosts for big dreams</div>
        </div>
      </div>
      <div class="row">
        <button id="installBtn" class="ghost" style="display:none">Install app</button>
        <span id="installedHint" class="muted" style="display:none">App installed ‚úÖ</span>
        <button id="themeBtn" class="ghost" title="Toggle light/dark">üåô</button>
      </div>
    </header>

    <main class="card" role="main" aria-live="polite" style="position:relative;">
      <div id="breathingRing" class="breathing-ring" style="display:none;"></div>
      <h2 style="text-align:center; font-weight:800; margin-top:0; font-size:22px;">Flora, you are great!</h2>
      <div class="meta">
        <span id="today"></span>
        <span class="spacer"></span>
        <span id="streak" title="Days in a row you‚Äôve checked in"></span>
      </div>

      <p id="quote" class="quote fadeable">Loading your mantra‚Ä¶</p>
      <p id="author" class="author fadeable"></p>

      <div class="row">
        <button id="newBtn" class="primary">New mantra</button>
        <button id="copyBtn">Copy</button>
        <button id="saveBtn" class="ghost">Save</button>
        <button id="shareBtn" class="ghost">Share</button>
      </div>

      <p class="list-title">Quick picks</p>
      <div id="chips" class="chips"></div>

      <details style="margin-top:16px">
        <summary>Add your own quote</summary>
        <div style="margin-top:10px; display:grid; gap:10px;">
          <input id="customText" class="input" placeholder="Your quote/mantra" />
          <input id="customAuthor" class="input" placeholder="Author (optional)" />
          <div class="row">
            <button id="addCustom" class="ghost">Add to rotation</button>
            <span class="muted">Your quotes stay on this device.</span>
          </div>
        </div>
      </details>

      <details style="margin-top:16px">
        <summary>‚ú® Affirmation mode</summary>
        <div style="margin-top:10px; display:grid; gap:10px;">
          <label class="muted"><input id="affToggle" type="checkbox" style="margin-right:8px; vertical-align:middle;"> Auto-rotate quotes</label>
          <label class="muted">Change every
            <select id="affDelay" class="input" style="margin-top:6px; max-width:160px;">
              <option value="3000">3 seconds</option>
              <option value="5000">5 seconds</option>
              <option value="8000">8 seconds</option>
            </select>
          </label>
        </div>
      </details>

      <details style="margin-top:16px">
        <summary>üîî Chime settings</summary>
        <div style="margin-top:10px; display:grid; gap:10px;">
          <label class="muted"><input id="chimeToggle" type="checkbox" style="margin-right:8px; vertical-align:middle;"> Play chime sound with each affirmation</label>
        </div>
      </details>

      <details style="margin-top:16px">
        <summary>ü´ß Breathing ring</summary>
        <div style="margin-top:10px; display:grid; gap:10px;">
          <label class="muted"><input id="ringToggle" type="checkbox" style="margin-right:8px; vertical-align:middle;"> Show breathing ring with affirmations</label>
        </div>
      </details>

      <section id="favoritesSection" style="margin-top:18px; display:none;">
        <p class="list-title">‚≠ê Favorites</p>
        <div id="favorites"></div>
      </section>
    </main>

    <p class="footer">Made with üíñ for teens who dream big. <a class="link" href="https://github.com/" target="_blank" rel="noreferrer">Open-source on GitHub</a></p>
  </div>

  <script>
    // ===== PWA install flow =====
    let deferredPrompt = null;
    const _installReady = () => {
      const btn = document.getElementById('installBtn');
      if (btn) btn.style.display = 'inline-block';
    };
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      _installReady();
    });
    window.addEventListener('appinstalled', () => {
      const btn = document.getElementById('installBtn');
      const hint = document.getElementById('installedHint');
      if (btn) btn.style.display = 'none';
      if (hint) hint.style.display = 'inline';
    });
    document.addEventListener('click', async (e) => {
      if (e.target && e.target.id === 'installBtn' && deferredPrompt) {
        deferredPrompt.prompt();
        try { await deferredPrompt.userChoice; } catch {}
        deferredPrompt = null;
        e.target.style.display = 'none';
      }
    });
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js').catch(()=>{});
    }

    const BASE_QUOTES = [
      { t: "You are enough, exactly as you are.", a: "Unknown" },
      { t: "Your light is meant to shine‚Äînever dim it for anyone.", a: "Unknown" },
      { t: "Believe in the power within you. You are unstoppable.", a: "Unknown" },
      { t: "You are worthy of love, joy, and all good things.", a: "Unknown" },
      { t: "Every day, you grow stronger‚Äîeven when it doesn‚Äôt feel like it.", a: "Unknown" },
      { t: "The world is brighter because you‚Äôre in it.", a: "Unknown" },
      { t: "You are allowed to take up space. You matter.", a: "Unknown" },
      { t: "Keep going‚Äîyou‚Äôre doing better than you think.", a: "Unknown" },
      { t: "You were born to be extraordinary.", a: "Unknown" },
      { t: "Never forget: you are loved beyond measure.", a: "Unknown" },
      { t: "Your dreams are valid. Believe in them.", a: "Unknown" },
      { t: "Be kind to yourself. You‚Äôre doing your best.", a: "Unknown" },
      { t: "Even on hard days, you are enough.", a: "Unknown" },
      { t: "Your heart is strong, your soul is beautiful.", a: "Unknown" },
      { t: "Breathe. You‚Äôve got this.", a: "Unknown" },
      { t: "You are loved, you are capable, you are enough.", a: "Unknown" },
      { t: "Trust yourself. You are becoming who you‚Äôre meant to be.", a: "Unknown" },
      { t: "You are a masterpiece in progress.", a: "Unknown" },
      { t: "Your kindness is your superpower.", a: "Unknown" },
      { t: "Shine bright‚Äîyour light inspires others.", a: "Unknown" }
    ];

    const $ = (sel) => document.querySelector(sel);
    function fmtDate(d = new Date()){ return d.toLocaleDateString(undefined,{weekday:'long',month:'long',day:'numeric'}); }
    function seedFromDate(date=new Date()){ const y=date.getFullYear(); const m=String(date.getMonth()+1).padStart(2,'0'); const d=String(date.getDate()).padStart(2,'0'); return Number(`${y}${m}${d}`); }
    function mulberry32(a){ return function(){ let t=a+=0x6D2B79F5; t=Math.imul(t^t>>>15,t|1); t^=t+Math.imul(t^t>>>7,t|61); return ((t^t>>>14)>>>0)/4294967296; } }
    function pickToday(q){ const rand=mulberry32(seedFromDate()); return q[Math.floor(rand()*q.length)]; }

    const store = {
      k:'flora-mantras-v1',
      load(){ try{ return JSON.parse(localStorage.getItem(this.k)) || { chimeEnabled:false, ringEnabled:false, favs:[], custom:[], lastOpen:null, streak:0, theme:'dark', affirmationsEnabled:false, affirmationsDelay:5000 }; } catch{ return { chimeEnabled:false, ringEnabled:false, favs:[], custom:[], lastOpen:null, streak:0, theme:'dark', affirmationsEnabled:false, affirmationsDelay:5000 }; } },
      save(v){ localStorage.setItem(this.k, JSON.stringify(v)); }
    };

    const state = store.load();
    document.documentElement.setAttribute('data-theme', state.theme || 'dark');

    (function updateStreak(){
      const todayKey = seedFromDate().toString();
      if (state.lastOpen !== todayKey) {
        const yesterdayKey = seedFromDate(new Date(Date.now()-86400000)).toString();
        state.streak = (state.lastOpen === yesterdayKey) ? (state.streak || 0) + 1 : 1;
        state.lastOpen = todayKey; store.save(state);
      }
    })();

    $('#today').textContent = fmtDate();
    $('#streak').textContent = `üî• Streak: ${state.streak} day${state.streak===1?'':'s'}`;

    function currentQuotes(){ return [...BASE_QUOTES, ...state.custom]; }
    function renderQuote(q, withFade=true){
      const qEl = $('#quote'); const aEl = $('#author');
      if (withFade){
        qEl.classList.add('is-hidden'); aEl.classList.add('is-hidden');
        setTimeout(()=>{ qEl.textContent = `‚Äú${q.t}‚Äù`; aEl.textContent = q.a ? `‚Äî ${q.a}` : ''; qEl.classList.remove('is-hidden'); aEl.classList.remove('is-hidden'); }, 180);
      } else {
        qEl.textContent = `‚Äú${q.t}‚Äù`; aEl.textContent = q.a ? `‚Äî ${q.a}` : '';
      }
    }‚Äù`; $('#author').textContent=q.a?`‚Äî ${q.a}`:''; }

    function renderChips(){
      const picks = [
        "You are enough.",
        "Shine bright‚Äîyour light inspires others.",
        "Breathe. You‚Äôve got this.",
        "Your kindness is your superpower.",
        "Keep going‚Äîyou‚Äôre doing better than you think.",
        "Believe in the power within you."
      ];
      const el = $('#chips'); el.innerHTML = '';
      picks.forEach(text => { const b=document.createElement('button'); b.className='pill'; b.textContent=text.length>36?text.slice(0,33)+'‚Ä¶':text; b.addEventListener('click',()=>renderQuote({t:text,a:''})); el.appendChild(b); });
    }

    function renderFavorites(){
      const sec=$('#favoritesSection'); const box=$('#favorites'); box.innerHTML='';
      if (!state.favs || state.favs.length===0){ sec.style.display='none'; return; }
      sec.style.display='block';
      state.favs.forEach((q,idx)=>{ const row=document.createElement('div'); row.className='fav';
        const p=document.createElement('p'); p.textContent=`‚Äú${q.t}‚Äù ${q.a ? '‚Äî '+q.a : ''}`;
        const del=document.createElement('button'); del.className='ghost'; del.textContent='Remove';
        del.addEventListener('click',()=>{ state.favs.splice(idx,1); store.save(state); renderFavorites(); });
        row.appendChild(p); row.appendChild(del); box.appendChild(row);
      });
    }

    const todayQuote = pickToday(currentQuotes());
    renderQuote(todayQuote); renderChips(); renderFavorites();

    // Affirmation mode UI init
    const affToggle = document.getElementById('affToggle');
    const affDelay = document.getElementById('affDelay');
    if (affToggle) affToggle.checked = !!state.affirmationsEnabled;
    if (affDelay) affDelay.value = String(state.affirmationsDelay || 5000);

    let affTimer = null;
    function nextQuote(){
      const q = currentQuotes();
      const current = $('#quote').textContent.replace(/[‚Äú‚Äù]/g,'');
      let pick; let guard=0;
      do { pick = q[Math.floor(Math.random()*q.length)]; guard++; } while (pick && pick.t === current && guard < 5);
      if (pick) {
        renderQuote(pick);
        if (state.chimeEnabled) {
          chime.currentTime = 0;
          chime.play().catch(()=>{});
        }
      }
    }
    function startAff(){ if (affTimer) clearInterval(affTimer); affTimer = setInterval(nextQuote, Number(state.affirmationsDelay||5000)); }
    function stopAff(){ if (affTimer) { clearInterval(affTimer); affTimer = null; } }
    if (state.affirmationsEnabled) startAff();

    // Breathing ring toggle
    const ring = document.getElementById('breathingRing');
    const ringToggle = document.getElementById('ringToggle');
    function updateRingSpeed(){
      if (!ring) return;
      const dur = Number(state.affirmationsDelay || 5000);
      ring.style.animation = `breathe ${dur}ms ease-in-out infinite`;
    }
    if (ringToggle) ringToggle.checked = !!state.ringEnabled;
    if (state.ringEnabled && ring) {
      ring.style.display='block';
      updateRingSpeed();
    }
    ringToggle?.addEventListener('change', (e)=>{
      state.ringEnabled = e.target.checked; store.save(state);
      ring.style.display = e.target.checked ? 'block' : 'none';
      if (e.target.checked) updateRingSpeed();
    });
      ring.style.display = e.target.checked ? 'block' : 'none';
    });

    // Chime sound setup
    const chime = new Audio('chime.mp3');
    const chimeToggle = document.getElementById('chimeToggle');
    if (chimeToggle) chimeToggle.checked = !!state.chimeEnabled;
    chimeToggle?.addEventListener('change', (e)=>{ state.chimeEnabled = e.target.checked; store.save(state); });

    affToggle?.addEventListener('change', (e)=>{ state.affirmationsEnabled = e.target.checked; store.save(state); e.target.checked ? startAff() : stopAff(); });
    affDelay?.addEventListener('change', (e)=>{ state.affirmationsDelay = Number(e.target.value)||5000; store.save(state); updateRingSpeed(); if (state.affirmationsEnabled) startAff(); });

    $('#newBtn').addEventListener('click', ()=>{
      const q=currentQuotes(); let pick; do{ pick=q[Math.floor(Math.random()*q.length)]; } while (pick.t === $('#quote').textContent.replace(/[‚Äú‚Äù]/g,'')); renderQuote(pick);
    });
    $('#copyBtn').addEventListener('click', async ()=>{
      const text = `${$('#quote').textContent} ${$('#author').textContent}`.trim();
      try{ await navigator.clipboard.writeText(text); flash('Copied!'); }catch{ flash('Copy failed'); }
    });
    $('#saveBtn').addEventListener('click', ()=>{
      const q={ t:$('#quote').textContent.replace(/[‚Äú‚Äù]/g,''), a:$('#author').textContent.replace(/^‚Äî\\s*/, '') };
      state.favs=state.favs||[];
      if(!state.favs.find(x=>x.t===q.t && x.a===q.a)){ state.favs.unshift(q); store.save(state); renderFavorites(); flash('Saved to favorites'); }
      else{ flash('Already in favorites'); }
    });
    $('#shareBtn').addEventListener('click', async ()=>{
      const text=`${$('#quote').textContent} ${
