<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Flora‚Äôs Magic Mantras</title>
  <meta name="description" content="Daily motivational quotes for teens ‚Äî positive, bite-sized mantras to power your day." />
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Cdefs%3E%3ClinearGradient id='g' x1='0' y1='0' x2='1' y2='1'%3E%3Cstop offset='0' stop-color='%238bc6ff'/%3E%3Cstop offset='1' stop-color='%23a78bfa'/%3E%3C/linearGradient%3E%3C/defs%3E%3Ccircle cx='32' cy='32' r='30' fill='url(%23g)' opacity='.2'/%3E%3Cpath d='M32 10c5 8 5 12 0 20c-5-8-5-12 0-20Z' fill='url(%23g)'/%3E%3Cpath d='M54 32c-8 5-12 5-20 0c8-5 12-5 20 0Z' fill='url(%23g)'/%3E%3Cpath d='M32 54c-5-8-5-12 0-20c5 8 5 12 0 20Z' fill='url(%23g)'/%3E%3Cpath d='M10 32c8-5 12-5 20 0c-8 5-12 5-20 0Z' fill='url(%23g)'/%3E%3C/svg%3E" />
  <style>
    :root { --bg:#0b1220; --card:#111a2e; --fg:#eaf1ff; --muted:#a8b3cf; --accent:#8bc6ff; --pill:#1a2540; }
    [data-theme="light"] { --bg:#f7f9ff; --card:#ffffff; --fg:#0f172a; --muted:#475569; --accent:#2563eb; --pill:#eef2ff; }
    *{box-sizing:border-box} html,body{height:100%}
    body{
      margin:0; font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";
      color:var(--fg);
      background: radial-gradient(1200px 800px at 100% -10%, rgba(139,198,255,.12), transparent 60%),
                  radial-gradient(900px 600px at -10% 110%, rgba(255,138,201,.12), transparent 60%),
                  var(--bg);
      display:grid; place-items:center; padding:24px;
    }
    .wrap{width:100%; max-width:760px;}
    header{display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:18px;}
    .brand{display:flex; align-items:center; gap:12px;}
    .logo{display:block}
    .title{font-weight:800; letter-spacing:.2px; font-size:20px;}
    .subtitle{color:var(--muted); font-size:13px; margin-top:2px;}
    .card{background:linear-gradient(180deg,rgba(255,255,255,.02),rgba(255,255,255,0)),var(--card);
      border:1px solid rgba(255,255,255,.06); border-radius:24px; box-shadow:0 10px 30px rgba(0,0,0,.25); padding:22px;}
    .quote{font-size:clamp(20px,4.2vw,30px); font-weight:700; letter-spacing:.2px; margin:10px 0 14px;}
    .author{color:var(--muted); font-size:14px;}
    .row{display:flex; flex-wrap:wrap; gap:10px; margin-top:16px;}
    button,.pill{appearance:none; border:1px solid transparent; background:var(--pill); color:var(--fg);
      padding:10px 14px; border-radius:999px; font-weight:600; cursor:pointer; transition:transform .06s ease, background .2s ease, opacity .2s ease;}
    button:hover{transform:translateY(-1px)} button:active{transform:translateY(0)}
    .primary{background:linear-gradient(135deg,var(--accent),#a78bfa); color:#fff;}
    .ghost{background:transparent; border-color:rgba(255,255,255,.12);}
    .meta{display:flex; align-items:center; gap:8px; color:var(--muted); font-size:13px;}
    .spacer{flex:1}
    .list-title{font-size:14px; color:var(--muted); margin:18px 2px 8px;}
    .chips{display:flex; flex-wrap:wrap; gap:8px;}
    .fav{display:grid; grid-template-columns:1fr auto; gap:8px; align-items:center;}
    .fav p{margin:0; font-weight:600;}
    details{background:rgba(255,255,255,.03); border:1px dashed rgba(255,255,255,.1); padding:14px; border-radius:16px;}
    summary{cursor:pointer; font-weight:700;}
    .input{width:100%; padding:10px 12px; border-radius:12px; border:1px solid rgba(255,255,255,.12); background:transparent; color:var(--fg); outline:none; font-size:14px;}
    .muted{color:var(--muted); font-size:14px;}
    .footer{text-align:center; color:var(--muted); font-size:12px; margin-top:16px;}
    .link{color:var(--accent); text-decoration:none;}
    .badge{font-size:11px; opacity:.8; padding:4px 8px; border-radius:999px; background:rgba(255,255,255,.08);}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <!-- Inline SVG logo -->
        <svg class="logo" width="36" height="36" viewBox="0 0 64 64" aria-hidden="true">
          <defs>
            <linearGradient id="g" x1="0" y1="0" x2="1" y2="1">
              <stop offset="0" stop-color="#8bc6ff"/><stop offset="1" stop-color="#a78bfa"/>
            </linearGradient>
          </defs>
          <circle cx="32" cy="32" r="30" fill="url(#g)" opacity="0.15"/>
          <path d="M32 10c5 8 5 12 0 20c-5-8-5-12 0-20Z" fill="url(#g)"/>
          <path d="M54 32c-8 5-12 5-20 0c8-5 12-5 20 0Z" fill="url(#g)"/>
          <path d="M32 54c-5-8-5-12 0-20c5 8 5 12 0 20Z" fill="url(#g)"/>
          <path d="M10 32c8-5 12-5 20 0c-8 5-12 5-20 0Z" fill="url(#g)"/>
        </svg>
        <div>
          <div class="title">Flora‚Äôs Magic Mantras <span class="badge">Teen Edition</span></div>
          <div class="subtitle">Daily boosts for confidence, kindness, and growth</div>
        </div>
      </div>
      <div class="row">
        <button id="musicBtn" class="ghost" title="Music">üéµ Off</button>
        <button id="themeBtn" class="ghost" title="Toggle light/dark">üåô</button>
        <button id="adminBtn" class="ghost" title="Creator Mode (locked)">üîí</button>
      </div>
    </header>

    <main class="card" role="main" aria-live="polite">
      <div class="meta">
        <span id="today"></span>
        <span class="spacer"></span>
        <span id="streak" title="Days in a row you‚Äôve checked in"></span>
      </div>

      <p id="quote" class="quote">Loading your mantra‚Ä¶</p>
      <p id="author" class="author"></p>

      <div class="row">
        <button id="newBtn" class="primary">New mantra</button>
        <button id="copyBtn">Copy</button>
        <button id="saveBtn" class="ghost">Save</button>
        <button id="shareBtn" class="ghost">Share</button>
      </div>

      <p class="list-title">Quick picks</p>
      <div id="chips" class="chips"></div>

      <details style="margin-top:16px">
        <summary>Add your own quote</summary>
        <div style="margin-top:10px; display:grid; gap:10px;">
          <input id="customText" class="input" placeholder="Your quote/mantra" />
          <input id="customAuthor" class="input" placeholder="Author (optional)" />
          <div class="row">
            <button id="addCustom" class="ghost">Add to rotation</button>
            <span class="muted">Your quotes stay on this device.</span>
          </div>
        </div>
      </details>

      <!-- Creator Mode (locked) -->
      <details id="adminPanel" style="margin-top:16px; display:none;">
        <summary><strong>Creator Mode</strong> ‚Äî manage quotes</summary>
        <div style="margin-top:10px; display:grid; gap:10px;">
          <div class="muted">Add quotes without code. Export <code>quotes.json</code> and upload it to your GitHub repo‚Äôs root. The app auto-loads it.</div>
          <div style="display:grid; gap:8px;">
            <input id="bulkQuote" class="input" placeholder="Quote text" />
            <input id="bulkAuthor" class="input" placeholder="Author (optional)" />
            <div class="row">
              <button id="addToGlobal" class="ghost">Add to list</button>
              <button id="exportJson" class="ghost">Export quotes.json</button>
              <label class="pill" style="cursor:pointer;">
                Import JSON<input id="importJson" type="file" accept="application/json" style="display:none;" />
              </label>
            </div>
          </div>
          <div>
            <p class="list-title">All quotes (global + custom)</p>
            <div id="adminList" class="fav"></div>
          </div>
          <div class="muted">How to publish: Download <code>quotes.json</code> ‚Üí GitHub repo ‚Üí Add file ‚Üí Upload ‚Üí Commit.</div>
        </div>
      </details>

      <section id="favoritesSection" style="margin-top:18px; display:none;">
        <p class="list-title">‚≠ê Favorites</p>
        <div id="favorites"></div>
      </section>
    </main>

    <p class="footer">
      Made with üíñ for teens who dream big. <a class="link" href="https://github.com/" target="_blank" rel="noreferrer">Open-source on GitHub</a>
    </p>
  </div>

  <!-- Background music (expects music.mp3 in repo root) -->
  <audio id="bgm" src="music.mp3" loop preload="none"></audio>

  <script>
    // ======= Config =======
    const CREATOR_PASS = 'flora'; // CHANGE this to your secret passphrase

    // ======= Teen-friendly starter quotes =======
    const BASE_QUOTES = [
      { t: "Small steps still move you forward.", a: "Unknown" },
      { t: "You‚Äôve survived 100% of your hard days.", a: "Unknown" },
      { t: "Be the kind of person you needed when you were younger.", a: "Unknown" },
      { t: "You are allowed to be a work in progress and a masterpiece at the same time.", a: "Unknown" },
      { t: "Progress, not perfection.", a: "Unknown" },
      { t: "Confidence is a skill‚Äîpractice it.", a: "Unknown" },
      { t: "Your future needs you. Your past doesn‚Äôt.", a: "Unknown" },
      { t: "Done is better than perfect.", a: "Sheryl Sandberg" },
      { t: "Dreams don‚Äôt work unless you do.", a: "John C. Maxwell" },
      { t: "You miss 100% of the shots you don‚Äôt take.", a: "Wayne Gretzky" },
      { t: "The best time to start was yesterday. The next best time is now.", a: "Unknown" },
      { t: "What you do today can improve all your tomorrows.", a: "Ralph Marston" },
      { t: "The secret of getting ahead is getting started.", a: "Mark Twain" },
      { t: "Make it happen. Shock everyone.", a: "Unknown" },
      { t: "You are the main character‚Äîact like it.", a: "Unknown" },
      { t: "Grow through what you go through.", a: "Unknown" },
      { t: "Kindness is cool. Pass it on.", a: "Unknown" },
      { t: "Talk to yourself like someone you love.", a: "Unknown" },
      { t: "It‚Äôs okay to be proud of how far you‚Äôve come.", a: "Unknown" },
      { t: "One kind thought can change a whole day.", a: "Unknown" }
    ];

    // Optional remote quotes from quotes.json
    let REMOTE_QUOTES = null;

    // ======= Utilities =======
    const $ = sel => document.querySelector(sel);
    function fmtDate(d = new Date()) { return d.toLocaleDateString(undefined, { weekday: 'long', month: 'long', day: 'numeric' }); }
    function seedFromDate(date = new Date()) { const y = date.getFullYear(); const m = String(date.getMonth()+1).padStart(2,'0'); const d = String(date.getDate()).padStart(2,'0'); return Number(`${y}${m}${d}`); }
    function mulberry32(a) { return function(){ let t = a += 0x6D2B79F5; t = Math.imul(t ^ t >>> 15, t | 1); t ^= t + Math.imul(t ^ t >>> 7, t | 61); return ((t ^ t >>> 14) >>> 0) / 4294967296; } }
    function pickToday(quotes) { const seed = seedFromDate(); const rand = mulberry32(seed); const i = Math.floor(rand() * quotes.length); return quotes[i]; }

    // ======= Storage =======
    const store = {
      k: 'flora-mantras-v3',
      load(){ try { return JSON.parse(localStorage.getItem(this.k)) || { favs:[], custom:[], lastOpen:null, streak:0, theme:'dark', music:false }; } catch { return { favs:[], custom:[], lastOpen:null, streak:0, theme:'dark', music:false }; } },
      save(v){ localStorage.setItem(this.k, JSON.stringify(v)); }
    };
    const state = store.load();

    // ======= Theme =======
    document.documentElement.setAttribute('data-theme', state.theme || 'dark');
    $('#themeBtn').textContent = (state.theme || 'dark') === 'dark' ? 'üåô' : 'üåû';
    $('#themeBtn').addEventListener('click', () => {
      const next = (document.documentElement.getAttribute('data-theme') === 'dark') ? 'light' : 'dark';
      document.documentElement.setAttribute('data-theme', next);
      state.theme = next; store.save(state);
      $('#themeBtn').textContent = next === 'dark' ? 'üåô' : 'üåû';
    });

    // ======= Music =======
    const bgm = $('#bgm');
    const musicBtn = $('#musicBtn');
    async function setMusic(on){
      try{
        if(on){
          // Load and try to play after user gesture
          if (!bgm.src) bgm.src = 'music.mp3';
          await bgm.play();
          musicBtn.textContent = 'üéµ On';
        } else {
          bgm.pause();
          musicBtn.textContent = 'üéµ Off';
        }
        state.music = on; store.save(state);
      }catch(e){
        // Autoplay likely blocked; show helpful state
        musicBtn.textContent = 'üéµ Tap to play';
      }
    }
    // Initialize button state
    musicBtn.textContent = state.music ? 'üéµ On' : 'üéµ Off';
    musicBtn.addEventListener('click', () => setMusic(!state.music));

    // ======= Streak =======
    (function updateStreak(){
      const todayKey = seedFromDate().toString();
      if (state.lastOpen !== todayKey) {
        const yesterdayKey = seedFromDate(new Date(Date.now()-86400000)).toString();
        state.streak = (state.lastOpen === yesterdayKey) ? (state.streak || 0) + 1 : 1;
        state.lastOpen = todayKey;
        store.save(state);
      }
    })();

    // ======= Rendering =======
    $('#today').textContent = fmtDate();
    $('#streak').textContent = `üî• Streak: ${state.streak} day${state.streak===1?'':'s'}`;
    function currentQuotes(){ const base = (REMOTE_QUOTES && REMOTE_QUOTES.length) ? REMOTE_QUOTES : BASE_QUOTES; return [...base, ...(state.custom||[])]; }
    function renderQuote(q){ $('#quote').textContent = `‚Äú${q.t}‚Äù`; $('#author').textContent = q.a ? `‚Äî ${q.a}` : ''; }
    function renderChips(){
      const picks = [
        "Believe in yourself",
        "Progress, not perfection",
        "Small steps still move you forward",
        "Done is better than perfect",
        "Grow through what you go through",
        "Talk to yourself like someone you love"
      ];
      const el = $('#chips'); el.innerHTML = '';
      picks.forEach(text => {
        const b = document.createElement('button');
        b.className = 'pill';
        b.textContent = text.length > 36 ? text.slice(0,33)+'‚Ä¶' : text;
        b.addEventListener('click', () => renderQuote({ t:text, a:'' }));
        el.appendChild(b);
      });
    }
    function renderFavorites(){
      const sec = $('#favoritesSection'); const box = $('#favorites'); box.innerHTML = '';
      if (!state.favs || state.favs.length === 0) { sec.style.display = 'none'; return; }
      sec.style.display = 'block';
      state.favs.forEach((q, idx) => {
        const row = document.createElement('div'); row.className = 'fav';
        const p = document.createElement('p'); p.textContent = `‚Äú${q.t}‚Äù ${q.a ? '‚Äî '+q.a : ''}`;
        const del = document.createElement('button'); del.className = 'ghost'; del.textContent = 'Remove';
        del.addEventListener('click', () => { state.favs.splice(idx,1); store.save(state); renderFavorites(); });
        row.appendChild(p); row.appendChild(del); box.appendChild(row);
      });
    }

    // ======= Initial load (optional remote quotes) =======
    async function init(){
      try{
        const res = await fetch('quotes.json', { cache: 'no-store' });
        if (res.ok) {
          const data = await res.json();
          if (Array.isArray(data)) REMOTE_QUOTES = data.filter(q => q && q.t);
        }
      }catch{}
      const todayQuote = pickToday(currentQuotes()); renderQuote(todayQuote);
      renderChips(); renderFavorites();
      if (state.music) { /* user opted-in previously, but must click to start due to autoplay policy */ }
    }
    init();

    // ======= Actions =======
    $('#newBtn').addEventListener('click', () => {
      const q = currentQuotes(); let pick;
      do { pick = q[Math.floor(Math.random()*q.length)]; }
      while (pick.t === $('#quote').textContent.replace(/[‚Äú‚Äù]/g,''));
      renderQuote(pick);
    });
    $('#copyBtn').addEventListener('click', async () => {
      const text = `${$('#quote').textContent} ${$('#author').textContent}`.trim();
      try { await navigator.clipboard.writeText(text); flash('Copied!'); } catch { flash('Copy failed'); }
    });
    $('#saveBtn').addEventListener('click', () => {
      const q = { t: $('#quote').textContent.replace(/[‚Äú‚Äù]/g,''), a: $('#author').textContent.replace(/^‚Äî\\s*/, '') };
      state.favs = state.favs || [];
      if (!state.favs.find(x => x.t === q.t && x.a === q.a)) {
        state.favs.unshift(q); store.save(state); renderFavorites(); flash('Saved to favorites');
      } else { flash('Already in favorites'); }
    });
    $('#shareBtn').addEventListener('click', async () => {
      const text = `${$('#quote').textContent} ${$('#author').textContent}`.trim();
      if (navigator.share) { try { await navigator.share({ title:'Flora‚Äôs Magic Mantras', text }); } catch{} }
      else { try { await navigator.clipboard.writeText(text); flash('Copied to share'); } catch { flash('Sharing not supported'); } }
    });
    $('#addCustom').addEventListener('click', () => {
      const t = $('#customText').value.trim(); const a = $('#customAuthor').value.trim();
      if (!t) { flash('Please enter a quote'); return; }
      state.custom = state.custom || []; state.custom.unshift({ t, a }); store.save(state);
      $('#customText').value = ''; $('#customAuthor').value = ''; flash('Added! It will appear in rotation.');
      if ($('#adminList')) renderAdminList();
    });

    // ======= Creator Mode (locked) =======
    const adminBtn = $('#adminBtn'); const adminPanel = $('#adminPanel');
    function toggleAdmin(open){ adminPanel.style.display = open ? 'block' : 'none'; adminBtn.textContent = open ? 'üîì' : 'üîí'; }
    adminBtn.addEventListener('click', () => {
      if (adminPanel.style.display === 'block') { toggleAdmin(false); return; }
      const pass = prompt('Enter passphrase to unlock Creator Mode:'); // simple lock
      if (pass === CREATOR_PASS) { toggleAdmin(true); }
      else if (pass !== null) { flash('Wrong passphrase'); }
    });

    function renderAdminList(){
      const box = $('#adminList'); if (!box) return;
      const list = [...(REMOTE_QUOTES && REMOTE_QUOTES.length ? REMOTE_QUOTES : BASE_QUOTES), ...(state.custom||[])];
      box.innerHTML = '';
      list.forEach((q,i) => {
        const row = document.createElement('div'); row.className = 'fav';
        const p = document.createElement('p'); p.textContent = `‚Äú${q.t}‚Äù ${q.a ? '‚Äî '+q.a : ''}`;
        const del = document.createElement('button'); del.className = 'ghost'; del.textContent = 'Remove';
        del.addEventListener('click', () => {
          const base = (REMOTE_QUOTES && REMOTE_QUOTES.length ? REMOTE_QUOTES : BASE_QUOTES);
          if (i < base.length) { flash('Built-in quote not removed here'); return; }
          const idx = i - base.length; state.custom.splice(idx, 1); store.save(state); renderAdminList(); flash('Removed');
        });
        row.appendChild(p); row.appendChild(del); box.appendChild(row);
      });
    }
    // Buttons inside Creator Mode
    document.addEventListener('click', (e) => {
      if (e.target && e.target.id === 'addToGlobal') {
        const t = $('#bulkQuote').value.trim(); const a = $('#bulkAuthor').value.trim();
        if (!t) { flash('Enter a quote'); return; }
        state.custom = state.custom || []; state.custom.unshift({ t, a }); store.save(state);
        $('#bulkQuote').value=''; $('#bulkAuthor').value=''; renderAdminList(); flash('Added to list');
      }
      if (e.target && e.target.id === 'exportJson') {
        const base = (REMOTE_QUOTES && REMOTE_QUOTES.length ? REMOTE_QUOTES : BASE_QUOTES);
        const data = [...base, ...(state.custom||[])];
        const blob = new Blob([JSON.stringify(data, null, 2)], { type:'application/json' });
        const url = URL.createObjectURL(blob); const a = document.createElement('a');
        a.href = url; a.download = 'quotes.json'; a.click(); URL.revokeObjectURL(url); flash('Exported quotes.json');
      }
    });
    $('#importJson')?.addEventListener('change', async (e) => {
      const file = e.target.files[0]; if (!file) return;
      try{
        const text = await file.text(); const arr = JSON.parse(text);
        if (!Array.isArray(arr)) throw new Error('Invalid file');
        const cleaned = arr.filter(q => q && q.t).map(q => ({ t:String(q.t), a:q.a ? String(q.a) : '' }));
        state.custom = [...cleaned, ...(state.custom||[])]; store.save(state);
        renderAdminList(); flash('Imported');
      }catch{ flash('Bad JSON file'); }
      finally { e.target.value = ''; }
    });

    // ======= Toast =======
    function flash(msg){
      const t = document.createElement('div'); t.textContent = msg;
      t.style.position='fixed'; t.style.left='50%'; t.style.bottom='24px'; t.style.transform='translateX(-50%)';
      t.style.background='rgba(0,0,0,.75)'; t.style.color='#fff'; t.style.padding='10px 14px'; t.style.borderRadius='12px';
      t.style.fontWeight='700'; t.style.zIndex='9999'; document.body.appendChild(t); setTimeout(()=> t.remove(), 1300);
    }

    // ======= Service worker (offline) =======
    if ('serviceWorker' in navigator) {
      const swCode = `self.addEventListener('install', e => { e.waitUntil(caches.open('flora-v3').then(c=>c.addAll(['./']))); });
self.addEventListener('fetch', e => { e.respondWith(caches.match(e.request).then(r => r || fetch(e.request))); });`;
      const blob = new Blob([swCode], { type: 'text/javascript' });
      const swURL = URL.createObjectURL(blob);
      navigator.serviceWorker.register(swURL).catch(()=>{});
    }

    // Build admin list after DOM is ready
    document.addEventListener('DOMContentLoaded', renderAdminList);
  </script>
</body>
</html>
