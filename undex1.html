<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Flora‚Äôs Magic Mantras</title>
  <meta name="description" content="Daily motivational quotes for teens ‚Äî positive, bite-sized mantras to power your day." />
  <meta name="theme-color" content="#0b1220" />
  <link rel="manifest" href="manifest.webmanifest" />
  <link rel="apple-touch-icon" href="icons/icon-192.png" />
  <link rel="icon" type="image/png" href="icons/icon-192.png" />
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='0.9em' x='0.1em' font-size='90'%3Eüå∏%3C/text%3E%3C/svg%3E" />
  <style>
    :root { --bg:#0b1220; --card:#111a2e; --fg:#eaf1ff; --muted:#a8b3cf; --accent:#8bc6ff; --pill:#1a2540; }
    [data-theme="light"] { --bg:#f7f9ff; --card:#ffffff; --fg:#0f172a; --muted:#475569; --accent:#2563eb; --pill:#eef2ff; }
    *{box-sizing:border-box} html,body{height:100%}
    body{ margin:0; font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";
      color:var(--fg);
      background: radial-gradient(1200px 800px at 100% -10%, rgba(139,198,255,.12), transparent 60%),
                  radial-gradient(900px 600px at -10% 110%, rgba(255,138,201,.12), transparent 60%), var(--bg);
      display:grid; place-items:center; padding:24px; }
    .wrap{width:100%; max-width:720px;}
    header{display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:18px;}
    .brand{display:flex; align-items:center; gap:10px;}
    .logo{font-size:28px}
    .title{font-weight:800; letter-spacing:.2px; font-size:20px;}
    .subtitle{color:var(--muted); font-size:13px; margin-top:2px;}
    .card{background:linear-gradient(180deg,rgba(255,255,255,.02),rgba(255,255,255,0)),var(--card); border:1px solid rgba(255,255,255,.06); border-radius:24px; box-shadow:0 10px 30px rgba(0,0,0,.25); padding:22px;}
    .quote{font-size:clamp(20px,4.2vw,30px); font-weight:700; letter-spacing:.2px; margin:10px 0 14px;}
    .author{color:var(--muted); font-size:14px;}
    .row{display:flex; flex-wrap:wrap; gap:10px; margin-top:16px;}
    button,.pill{appearance:none; border:1px solid transparent; background:var(--pill); color:var(--fg); padding:10px 14px; border-radius:999px; font-weight:600; cursor:pointer; transition:transform .06s ease, background .2s ease, opacity .2s ease;}
    button:hover{transform:translateY(-1px)} button:active{transform:translateY(0)}
    .primary{background:linear-gradient(135deg,var(--accent),#a78bfa); color:#fff;}
    .ghost{background:transparent; border-color:rgba(255,255,255,.12);}
    .meta{display:flex; align-items:center; gap:8px; color:var(--muted); font-size:13px;}
    .spacer{flex:1}
    .list-title{font-size:14px; color:var(--muted); margin:18px 2px 8px;}
    .chips{display:flex; flex-wrap:wrap; gap:8px;}
    .fav{display:grid; grid-template-columns:1fr auto; gap:8px; align-items:center;}
    .fav p{margin:0; font-weight:600;}
    details{background:rgba(255,255,255,.03); border:1px dashed rgba(255,255,255,.1); padding:14px; border-radius:16px;}
    summary{cursor:pointer; font-weight:700;}
    .input{width:100%; padding:10px 12px; border-radius:12px; border:1px solid rgba(255,255,255,.12); background:transparent; color:var(--fg); outline:none; font-size:14px;}
    .muted{color:var(--muted); font-size:14px;}
    .footer{text-align:center; color:var(--muted); font-size:12px; margin-top:16px;}
    .link{color:var(--accent); text-decoration:none;}
    .install-tip{font-size:12px; color:var(--muted); margin-left:6px;}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo">üå∏</div>
        <div>
          <div class="title">Flora‚Äôs Magic Mantras</div>
          <div class="subtitle">Daily motivational quotes ‚Äî simple boosts for big dreams</div>
        </div>
      </div>
      <div class="row">
        <button id="installBtn" class="ghost" style="display:none">Install app</button>
        <span id="installedHint" class="install-tip" style="display:none">App installed ‚úÖ</span>
        <button id="themeBtn" class="ghost" title="Toggle light/dark">üåô</button>
      </div>
    </header>

    <main class="card" role="main" aria-live="polite">
      <div class="meta">
        <span id="today"></span>
        <span class="spacer"></span>
        <span id="streak" title="Days in a row you‚Äôve checked in"></span>
      </div>

      <p id="quote" class="quote">Loading your mantra‚Ä¶</p>
      <p id="author" class="author"></p>

      <div class="row">
        <button id="newBtn" class="primary">New mantra</button>
        <button id="copyBtn">Copy</button>
        <button id="saveBtn" class="ghost">Save</button>
        <button id="shareBtn" class="ghost">Share</button>
      </div>

      <p class="list-title">Quick picks</p>
      <div id="chips" class="chips"></div>

      <details style="margin-top:16px">
        <summary>Add your own quote</summary>
        <div style="margin-top:10px; display:grid; gap:10px;">
          <input id="customText" class="input" placeholder="Your quote/mantra" />
          <input id="customAuthor" class="input" placeholder="Author (optional)" />
          <div class="row">
            <button id="addCustom" class="ghost">Add to rotation</button>
            <span class="muted">Your quotes stay on this device.</span>
          </div>
        </div>
      </details>

      <section id="favoritesSection" style="margin-top:18px; display:none;">
        <p class="list-title">‚≠ê Favorites</p>
        <div id="favorites"></div>
      </section>
    </main>

    <p class="footer">Made with üíñ for teens who dream big. <a class="link" href="https://github.com/" target="_blank" rel="noreferrer">Open-source on GitHub</a></p>
  </div>

  <script>
    // ===== PWA install flow =====
    let deferredPrompt = null;
    const installBtn = document.getElementById('installBtn');
    const installedHint = document.getElementById('installedHint');

    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();           // stash the event for later
      deferredPrompt = e;
      installBtn.style.display = 'inline-block';
    });

    installBtn.addEventListener('click', async () => {
      if (!deferredPrompt) return;
      deferredPrompt.prompt();
      const { outcome } = await deferredPrompt.userChoice;
      deferredPrompt = null;
      installBtn.style.display = 'none';
      if (outcome === 'accepted') installedHint.style.display = 'inline';
    });

    window.addEventListener('appinstalled', () => {
      installBtn.style.display = 'none';
      installedHint.style.display = 'inline';
    });

    // Register a static service worker (for PWA/offline)
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js').catch(()=>{});
    }

    // ===== Existing app logic (unchanged) =====
    const BASE_QUOTES = [
      { t: "You are allowed to be a work in progress and a masterpiece at the same time.", a: "Unknown" },
      { t: "Small steps still move you forward.", a: "Unknown" },
      { t: "Your future needs you. Your past doesn‚Äôt.", a: "Unknown" },
      { t: "Be the kind of person you needed when you were younger.", a: "Unknown" },
      { t: "Courage grows when you show up.", a: "Unknown" },
      { t: "You‚Äôve survived 100% of your hard days.", a: "Unknown" },
      { t: "Confidence is a skill‚Äîpractice it.", a: "Unknown" },
      { t: "Done is better than perfect.", a: "Sheryl Sandberg" },
      { t: "Dreams don‚Äôt work unless you do.", a: "John C. Maxwell" },
      { t: "You miss 100% of the shots you don‚Äôt take.", a: "Wayne Gretzky" },
      { t: "The best time to start was yesterday. The next best time is now.", a: "Unknown" },
      { t: "What you do today can improve all your tomorrows.", a: "Ralph Marston" },
      { t: "The secret of getting ahead is getting started.", a: "Mark Twain" },
      { t: "Progress, not perfection.", a: "Unknown" },
      { t: "Your vibe attracts your tribe.", a: "Unknown" },
      { t: "Make it happen. Shock everyone.", a: "Unknown" },
      { t: "You are the main character‚Äîact like it.", a: "Unknown" },
      { t: "Grow through what you go through.", a: "Unknown" },
      { t: "You got this. Like, actually.", a: "Unknown" },
      { t: "One kind thought can change a whole day.", a: "Unknown" }
    ];

    const $ = (sel) => document.querySelector(sel);
    function fmtDate(d = new Date()){ return d.toLocaleDateString(undefined,{weekday:'long',month:'long',day:'numeric'}); }
    function seedFromDate(date=new Date()){ const y=date.getFullYear(); const m=String(date.getMonth()+1).padStart(2,'0'); const d=String(date.getDate()).padStart(2,'0'); return Number(`${y}${m}${d}`); }
    function mulberry32(a){ return function(){ let t=a+=0x6D2B79F5; t=Math.imul(t^t>>>15,t|1); t^=t+Math.imul(t^t>>>7,t|61); return ((t^t>>>14)>>>0)/4294967296; } }
    function pickToday(q){ const rand=mulberry32(seedFromDate()); return q[Math.floor(rand()*q.length)]; }

    const store = {
      k:'flora-mantras-v1',
      load(){ try{ return JSON.parse(localStorage.getItem(this.k)) || { favs:[], custom:[], lastOpen:null, streak:0, theme:'dark' }; } catch{ return { favs:[], custom:[], lastOpen:null, streak:0, theme:'dark' }; } },
      save(v){ localStorage.setItem(this.k, JSON.stringify(v)); }
    };

    const state = store.load();
    document.documentElement.setAttribute('data-theme', state.theme || 'dark');

    (function updateStreak(){
      const todayKey = seedFromDate().toString();
      if (state.lastOpen !== todayKey) {
        const yesterdayKey = seedFromDate(new Date(Date.now()-86400000)).toString();
        state.streak = (state.lastOpen === yesterdayKey) ? (state.streak || 0) + 1 : 1;
        state.lastOpen = todayKey; store.save(state);
      }
    })();

    $('#today').textContent = fmtDate();
    $('#streak').textContent = `üî• Streak: ${state.streak} day${state.streak===1?'':'s'}`;

    function currentQuotes(){ return [...BASE_QUOTES, ...state.custom]; }
    function renderQuote(q){ $('#quote').textContent=`‚Äú${q.t}‚Äù`; $('#author').textContent=q.a?`‚Äî ${q.a}`:''; }

    function renderChips(){
      const picks = [
        "Believe in yourself",
        "Progress, not perfection",
        "Small steps still move you forward",
        "Done is better than perfect",
        "Grow through what you go through",
        "You‚Äôve survived 100% of your hard days"
      ];
      const el = $('#chips'); el.innerHTML = '';
      picks.forEach(text => { const b=document.createElement('button'); b.className='pill'; b.textContent=text.length>36?text.slice(0,33)+'‚Ä¶':text; b.addEventListener('click',()=>renderQuote({t:text,a:''})); el.appendChild(b); });
    }

    function renderFavorites(){
      const sec=$('#favoritesSection'); const box=$('#favorites'); box.innerHTML='';
      if (!state.favs || state.favs.length===0){ sec.style.display='none'; return; }
      sec.style.display='block';
      state.favs.forEach((q,idx)=>{ const row=document.createElement('div'); row.className='fav';
        const p=document.createElement('p'); p.textContent=`‚Äú${q.t}‚Äù ${q.a ? '‚Äî '+q.a : ''}`;
        const del=document.createElement('button'); del.className='ghost'; del.textContent='Remove';
        del.addEventListener('click',()=>{ state.favs.splice(idx,1); store.save(state); renderFavorites(); });
        row.appendChild(p); row.appendChild(del); box.appendChild(row);
      });
    }

    const todayQuote = pickToday(currentQuotes());
    renderQuote(todayQuote); renderChips(); renderFavorites();

    $('#newBtn').addEventListener('click', ()=>{
      const q=currentQuotes(); let pick; do{ pick=q[Math.floor(Math.random()*q.length)]; } while (pick.t === $('#quote').textContent.replace(/[‚Äú‚Äù]/g,'')); renderQuote(pick);
    });
    $('#copyBtn').addEventListener('click', async ()=>{
      const text = `${$('#quote').textContent} ${$('#author').textContent}`.trim();
      try{ await navigator.clipboard.writeText(text); flash('Copied!'); }catch{ flash('Copy failed'); }
    });
    $('#saveBtn').addEventListener('click', ()=>{
      const q={ t:$('#quote').textContent.replace(/[‚Äú‚Äù]/g,''), a:$('#author').textContent.replace(/^‚Äî\\s*/, '') };
      state.favs=state.favs||[];
      if(!state.favs.find(x=>x.t===q.t && x.a===q.a)){ state.favs.unshift(q); store.save(state); renderFavorites(); flash('Saved to favorites'); }
      else{ flash('Already in favorites'); }
    });
    $('#shareBtn').addEventListener('click', async ()=>{
      const text=`${$('#quote').textContent} ${$('#author').textContent}`.trim();
      if (navigator.share){ try{ await navigator.share({ title:'Flora‚Äôs Magic Mantras', text }); }catch{} }
      else { try{ await navigator.clipboard.writeText(text); flash('Copied to share'); }catch{ flash('Sharing not supported'); } }
    });

    $('#addCustom').addEventListener('click', ()=>{
      const t=$('#customText').value.trim(); const a=$('#customAuthor').value.trim();
      if(!t){ flash('Please enter a quote'); return; }
      state.custom=state.custom||[]; state.custom.unshift({ t, a }); store.save(state);
      $('#customText').value=''; $('#customAuthor').value=''; flash('Added! It will appear in rotation.');
    });

    $('#themeBtn').addEventListener('click', ()=>{
      const cur=document.documentElement.getAttribute('data-theme')||'dark';
      const next=cur==='dark'?'light':'dark';
      document.documentElement.setAttribute('data-theme', next);
      state.theme=next; store.save(state);
      $('#themeBtn').textContent = next==='dark'?'üåô':'üåû';
    });
    $('#themeBtn').textContent=(document.documentElement.getAttribute('data-theme')||'dark')==='dark'?'üåô':'üåû';

    function flash(msg){
      const t=document.createElement('div');
      t.textContent=msg; t.style.position='fixed'; t.style.left='50%'; t.style.bottom='24px'; t.style.transform='translateX(-50%)';
      t.style.background='rgba(0,0,0,.75)'; t.style.color='#fff'; t.style.padding='10px 14px'; t.style.borderRadius='12px'; t.style.fontWeight='700'; t.style.zIndex='9999';
      document.body.appendChild(t); setTimeout(()=> t.remove(), 1300);
    }
  </script>
</body>
</html>
